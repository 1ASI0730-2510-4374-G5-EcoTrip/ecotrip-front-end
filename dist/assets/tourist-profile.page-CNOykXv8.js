import{_ as F,D as z,r as y,m as G,A as k,i as L,a as p,e as x,f as g,b as r,g as S,t as l,u as h,H as M,F as N,p as D,I as j,n as V,l as $,j as H,s as B,J,h as C,y as K,o as u,k as O,G as Q}from"./index-CE-419vR.js";import{h as I}from"./httpClient-DusnwknQ.js";class U{constructor({id:s,name:t,email:o,avatar:n,preferences:i={adventureTypes:[],sustainability:!0},contactInfo:f={phone:"",address:""}}){this.id=s,this.name=t,this.email=o,this.avatar=n,this.preferences=i,this.contactInfo=f}get fullName(){return this.name}hasPreference(s){return this.preferences.adventureTypes.includes(s)}prefersSustainability(){return this.preferences.sustainability}updatePreferences(s){this.preferences={...this.preferences,...s}}updateContactInfo(s){this.contactInfo={...this.contactInfo,...s}}}class _{static toEntityFromResource(s){var t,o,n,i;if(!s)return console.error("TouristAssembler: Received null resource"),null;console.log("TouristAssembler: Processing resource:",s);try{return new U({id:s.id,name:s.name,email:s.email,avatar:s.avatar||"https://i.pravatar.cc/150?u=tourist1",preferences:{adventureTypes:Array.isArray((t=s.preferences)==null?void 0:t.adventureTypes)?s.preferences.adventureTypes:[],sustainability:!!((o=s.preferences)!=null&&o.sustainability)},contactInfo:{phone:((n=s.contactInfo)==null?void 0:n.phone)||"",address:((i=s.contactInfo)==null?void 0:i.address)||""}})}catch(f){return console.error("TouristAssembler: Error creating tourist entity:",f),null}}static toRequestPayload(s){return{id:s.id,name:s.name,email:s.email,avatar:s.avatar,preferences:{adventureTypes:s.preferences.adventureTypes,sustainability:s.preferences.sustainability},contactInfo:{phone:s.contactInfo.phone,address:s.contactInfo.address}}}}const R="http://localhost:3003";class W{async getProfile(s){var t;try{if(console.log("[TouristApiService] Getting profile for user:",s),!s)throw console.error("[TouristApiService] Tourist ID is missing"),new Error("Se requiere ID de turista");console.log("[TouristApiService] Making request to:",`/users/${s}`);const o=await I.get(`/users/${s}`);if(console.log("[TouristApiService] Raw API response:",o.data),!o.data)throw console.error("[TouristApiService] Empty response from server"),new Error("No se recibieron datos del servidor");if(!o.data.id||!o.data.role||o.data.role!=="tourist")throw console.error("[TouristApiService] Invalid user data:",o.data),new Error("Los datos del usuario no son válidos");const n=_.toEntityFromResource(o.data);if(console.log("[TouristApiService] Mapped tourist data:",n),!n)throw console.error("[TouristApiService] Failed to map data"),new Error("Error al procesar los datos del usuario");return{data:n}}catch(o){throw console.error("[TouristApiService] Error fetching profile:",o),((t=o.response)==null?void 0:t.status)===404?new Error("Usuario no encontrado"):new Error("Error al cargar el perfil: "+(o.message||"Error desconocido"))}}async updateProfile(s,t){try{if(!s)throw new Error("ID de turista es requerido");const o=_.toRequestPayload(t);console.log("[TouristApiService] Updating profile with payload:",o);const n=await I.put(`${R}/users/${s}`,o);return{data:_.toEntityFromResource(n.data)}}catch(o){throw console.error("[TouristApiService] Error updating profile:",o),this.handleError(o)}}async getBookedExperiences(s){try{if(!s)throw new Error("Tourist ID is required");return{data:(await I.get(`${R}/reservations?userId=${s}`)).data.map(o=>({id:o.id,experienceName:o.experienceName,date:new Date(o.date),status:o.status}))}}catch(t){throw console.error("[TouristApiService] Error fetching bookings:",t),this.handleError(t)}}handleError(s){if(console.error("TouristApiService Error:",s),!s.response)return localStorage.clear(),new Error("Error de conexión. Por favor, intenta nuevamente.");switch(s.response.status){case 400:return new Error("Datos de solicitud inválidos");case 401:return localStorage.clear(),new Error("Sesión expirada. Por favor, vuelve a iniciar sesión.");case 403:return new Error("No tienes permisos para realizar esta acción");case 404:return new Error("No se encontró el perfil del turista");case 500:return new Error("Error en el servidor. Por favor, intenta más tarde.");default:return s}}}class X{constructor(s){this.touristApiService=s}async getProfile(s){try{if(!s)throw console.error("[TouristService] No userId provided"),new Error("Se requiere ID de usuario");console.log("[TouristService] Getting profile for user:",s);const t=await this.touristApiService.getProfile(s);if(console.log("[TouristService] Profile response:",t),!t||!t.data)throw console.error("[TouristService] No data received from API"),new Error("No se pudo cargar el perfil");if(!t.data.id)throw console.error("[TouristService] Invalid profile data:",t.data),new Error("Datos de perfil inválidos");return t.data}catch(t){throw console.error("[TouristService] Error in getProfile:",t),t}}async updateProfile(s){return(await this.touristApiService.updateProfile(s.id,s)).data}async getBookedExperiences(s){return(await this.touristApiService.getBookedExperiences(s)).data}}const Y={class:"tourist-profile"},Z={key:0,class:"loading-overlay"},ee={key:1,class:"error-message"},re={key:2},se={class:"header"},oe={class:"profile-header"},te={class:"profile-info"},ie={class:"tourist-name"},ae={class:"tourist-email"},ne={class:"content-grid"},le={class:"main-col"},ue={class:"preferences-section"},de={class:"adventure-types"},ce={class:"adventure-chips"},pe={class:"eco-preference"},fe={class:"sustainability-status"},ve={class:"contact-section"},me={class:"contact-details"},ge={class:"contact-item"},he={class:"contact-item"},we={class:"contact-item"},ye={class:"side-col"},Ee={class:"bookings-section"},Te={key:0,class:"bookings-list"},be={class:"booking-header"},Se={class:"booking-date"},Pe={key:1,class:"empty-bookings"},Ie={class:"edit-form"},_e={key:0,class:"error-message"},Ae={class:"form-field"},ke={class:"form-field"},xe={class:"form-field"},Ne={class:"dialog-footer"},De={__name:"tourist-profile.page",setup(E){const{t:s}=z(),t=L(),o=new W,n=new X(o),i=y(new U({id:"",name:"",email:"",avatar:"",preferences:{adventureTypes:[],sustainability:!1},contactInfo:{phone:"",address:""}})),f=y(!1),P=y([]),v=y(!1),m=y(null);G(async()=>{var d,e,T,a;v.value=!0,m.value=null;try{const c=k.fromStorage();if(console.log("[TouristProfile] Session:",c),!(c!=null&&c.isValid())){console.log("[TouristProfile] Invalid session, redirecting to login"),await t.push("/login");return}if(!c.id)throw console.error("[TouristProfile] No user ID in session"),new Error("No se pudo identificar al usuario - ID no encontrado en la sesión");if(!c.isTourist()){await t.push("/experiences");return}const b=c.userId;if(!b)throw new Error("No se pudo identificar al usuario");console.log("[TouristProfilePage] Getting data for user:",b);const[w,A]=await Promise.all([n.getProfile(b),n.getBookedExperiences(b)]);if(console.log("[TouristProfilePage] Profile data received:",w),console.log("[TouristProfilePage] Bookings data received:",A),!w)throw new Error("No se pudo cargar el perfil del usuario");i.value={...i.value,...w,preferences:{adventureTypes:((d=w.preferences)==null?void 0:d.adventureTypes)||[],sustainability:!!((e=w.preferences)!=null&&e.sustainability)},contactInfo:{phone:((T=w.contactInfo)==null?void 0:T.phone)||"",address:((a=w.contactInfo)==null?void 0:a.address)||""}},console.log("[TouristProfilePage] Updated tourist data:",i.value),P.value=A||[]}catch(c){console.error("Error loading tourist data:",c),m.value=c.message||"Error al cargar el perfil"}finally{v.value=!1}});async function q(){try{v.value=!0,m.value=null;const d=k.fromStorage();if(!(d!=null&&d.userId))throw new Error("No se pudo identificar al usuario");await n.updateProfile(i.value),f.value=!1}catch(d){console.error("Error updating profile:",d),m.value=d.message||"Error al guardar los cambios"}finally{v.value=!1}}return(d,e)=>{const T=H("router-link");return u(),p("div",Y,[v.value?(u(),p("div",Z,e[6]||(e[6]=[r("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2rem"}},null,-1)]))):x("",!0),m.value?(u(),p("div",ee,[e[7]||(e[7]=r("i",{class:"pi pi-exclamation-triangle"},null,-1)),S(" "+l(m.value),1)])):(u(),p("div",re,[r("div",se,[r("div",oe,[g(h(M),{image:i.value.avatar,size:"xlarge",shape:"circle"},null,8,["image"]),r("div",te,[r("h1",ie,l(i.value.name),1),r("p",ae,l(i.value.email),1)])]),r("button",{class:"edit-profile-button",onClick:e[0]||(e[0]=a=>f.value=!0)},e[8]||(e[8]=[r("i",{class:"pi pi-pencil"},null,-1),r("span",null,"Editar perfil",-1)]))]),r("div",ne,[r("div",le,[r("section",ue,[e[11]||(e[11]=r("h2",null,"Preferencias de viaje",-1)),r("div",de,[e[9]||(e[9]=r("h3",null,"Tipos de aventura preferidos",-1)),r("div",ce,[(u(!0),p(N,null,D(i.value.preferences.adventureTypes,a=>(u(),O(h(Q),{key:a,label:a,class:"adventure-type-chip"},null,8,["label"]))),128))])]),r("div",pe,[e[10]||(e[10]=r("h3",null,"Preferencia de sostenibilidad",-1)),r("div",fe,[r("i",{class:V(["pi",i.value.preferences.sustainability?"pi-check-circle":"pi-times-circle"]),style:j({color:i.value.preferences.sustainability?"#047e77":"#dc2626"})},null,6),r("span",null,l(i.value.preferences.sustainability?"Interesado en experiencias eco-amigables":"Sin preferencias eco-amigables"),1)])])]),r("section",ve,[e[18]||(e[18]=r("h2",null,"Información de contacto",-1)),r("div",me,[r("div",ge,[e[13]||(e[13]=r("i",{class:"pi pi-phone"},null,-1)),r("div",null,[e[12]||(e[12]=r("h4",null,"Teléfono",-1)),r("p",null,l(i.value.contactInfo.phone||"No especificado"),1)])]),r("div",he,[e[15]||(e[15]=r("i",{class:"pi pi-map-marker"},null,-1)),r("div",null,[e[14]||(e[14]=r("h4",null,"Dirección",-1)),r("p",null,l(i.value.contactInfo.address||"No especificada"),1)])]),r("div",we,[e[17]||(e[17]=r("i",{class:"pi pi-envelope"},null,-1)),r("div",null,[e[16]||(e[16]=r("h4",null,"Email",-1)),r("p",null,l(i.value.email),1)])])])])]),r("div",ye,[r("section",Ee,[e[23]||(e[23]=r("h2",null,"Mis reservas",-1)),P.value.length>0?(u(),p("div",Te,[(u(!0),p(N,null,D(P.value,a=>(u(),p("div",{key:a.id,class:"booking-card"},[r("div",be,[r("h3",null,l(a.experienceName),1),r("span",{class:V(["status-badge",a.status.toLowerCase()])},l(a.status),3)]),r("p",Se,[e[19]||(e[19]=r("i",{class:"pi pi-calendar"},null,-1)),S(" "+l(new Date(a.date).toLocaleDateString()),1)])]))),128))])):(u(),p("div",Pe,[e[21]||(e[21]=r("i",{class:"pi pi-calendar-times"},null,-1)),e[22]||(e[22]=r("p",null,"Aún no tienes reservas",-1)),g(T,{to:"/experiences",class:"browse-link"},{default:$(()=>e[20]||(e[20]=[S(" Explorar experiencias ")])),_:1,__:[20]})]))])])])])),g(h(K),{visible:f.value,"onUpdate:visible":e[5]||(e[5]=a=>f.value=a),modal:"",header:"Editar perfil",style:{width:"450px"},closable:!v.value},{default:$(()=>[r("div",Ie,[m.value?(u(),p("div",_e,[e[24]||(e[24]=r("i",{class:"pi pi-exclamation-triangle"},null,-1)),S(" "+l(m.value),1)])):x("",!0),r("div",Ae,[e[25]||(e[25]=r("label",null,"Nombre",-1)),g(h(B),{modelValue:i.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.name=a),class:"w-full"},null,8,["modelValue"])]),r("div",ke,[e[26]||(e[26]=r("label",null,"Teléfono",-1)),g(h(B),{modelValue:i.value.contactInfo.phone,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.contactInfo.phone=a),class:"w-full"},null,8,["modelValue"])]),r("div",xe,[e[27]||(e[27]=r("label",null,"Dirección",-1)),g(h(J),{modelValue:i.value.contactInfo.address,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.contactInfo.address=a),rows:"3",class:"w-full"},null,8,["modelValue"])]),r("div",Ne,[g(h(C),{label:"Cancelar",severity:"secondary",onClick:e[4]||(e[4]=a=>f.value=!1),disabled:v.value},null,8,["disabled"]),g(h(C),{label:"Guardar",onClick:q,loading:v.value},null,8,["loading"])])])]),_:1},8,["visible","closable"])])}}},Be=F(De,[["__scopeId","data-v-354dd19c"]]);export{Be as default};

import{_ as T,r as c,c as h,m as B,a as i,b as e,e as b,g as E,t as n,F as L,k as V,w as j,A as q,i as z,o as l}from"./index-BPhHBPve.js";import{E as G}from"./experience.service-ClOJtLbE.js";import"./httpClient-DpjTLT7X.js";const P={class:"manage-experiences"},H={key:0,class:"loading"},J={key:1,class:"error"},K={key:2,class:"content"},O={class:"stats"},Q={class:"stat-card"},U={class:"stat-number"},W={class:"stat-card"},X={class:"stat-number"},Y={class:"stat-card"},Z={class:"stat-number"},ee={class:"experiences-grid"},se={class:"card-image"},te=["src","alt"],ae={class:"card-overlay"},ne={class:"actions"},ie=["onClick"],le=["onClick"],oe={class:"card-content"},re={class:"card-title"},ce={class:"card-location"},de={class:"card-description"},ue={class:"card-meta"},pe={class:"difficulty"},ve={class:"price"},me={class:"card-stats"},ge={class:"stat"},xe={class:"stat"},_e={key:0,class:"empty-state"},Ee={class:"modal-body"},fe={class:"modal-footer"},ye=["disabled"],he={key:0,class:"pi pi-spinner pi-spin"},be={key:1},ke={__name:"manage-experiences-new.page",setup(we){const f=z(),k=new G,o=c([]),u=c([]),x=c(!0),p=c(null),_=c(!1),d=c(null),v=c(!1),w=h(()=>u.value.length),C=h(()=>o.value.filter(t=>t.status!=="inactive").length),M=async()=>{try{x.value=!0,p.value=null;const t=q.fromStorage();if(!(t!=null&&t.isAgency()))throw new Error("Acceso denegado: Solo para agencias");const s=await k.getAllExperiences();console.log("[ManageExperiences] All experiences:",s),console.log("[ManageExperiences] Current agency ID:",t.userId),o.value=s.filter(r=>{var g;const a=r.agencyId||((g=r.agency)==null?void 0:g.id);return console.log("[ManageExperiences] Experience agencyId:",a,"Session userId:",t.userId),a===t.userId}),console.log("[ManageExperiences] Filtered experiences:",o.value),await I()}catch(t){console.error("[ManageExperiences] Error loading experiences:",t),p.value=t.message}finally{x.value=!1}},I=async()=>{try{const s=await(await fetch("http://localhost:3003/reservations")).json(),r=o.value.map(a=>a.id);u.value=s.filter(a=>r.includes(a.experienceId)),console.log("[ManageExperiences] My reservations:",u.value)}catch(t){console.error("[ManageExperiences] Error loading reservations:",t)}},A=t=>t.images&&t.images.length>0?t.images[0]:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400",S=t=>t?t.length>100?t.substring(0,100)+"...":t:"Sin descripción",D=t=>{const s=t.price;return typeof s=="object"&&s.amount?`€${s.amount}`:`€${s||60}`},N=t=>u.value.filter(s=>s.experienceId===t).length,y=()=>{f.push("/manage-experiences/create")},R=t=>{f.push(`/manage-experiences/${t.id}/edit`)},$=t=>{d.value=t,_.value=!0},m=()=>{_.value=!1,d.value=null},F=async()=>{if(d.value)try{if(v.value=!0,(await fetch(`http://localhost:3003/experiences/${d.value.id}`,{method:"DELETE"})).ok)o.value=o.value.filter(s=>s.id!==d.value.id),alert("Experiencia eliminada exitosamente"),m();else throw new Error("Error al eliminar la experiencia")}catch(t){console.error("[ManageExperiences] Error deleting experience:",t),alert("Error al eliminar la experiencia")}finally{v.value=!1}};return B(()=>{M()}),(t,s)=>{var r;return l(),i("div",P,[e("div",{class:"header"},[s[2]||(s[2]=e("div",null,[e("h1",null,"Gestionar Experiencias"),e("p",{class:"subtitle"},"Administra las experiencias de tu agencia")],-1)),e("button",{onClick:y,class:"btn-primary"},s[1]||(s[1]=[e("i",{class:"pi pi-plus"},null,-1),E(" Nueva Experiencia ")]))]),x.value?(l(),i("div",H,s[3]||(s[3]=[e("i",{class:"pi pi-spinner pi-spin"},null,-1),e("span",null,"Cargando experiencias...",-1)]))):p.value?(l(),i("div",J,[s[4]||(s[4]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),e("span",null,n(p.value),1)])):(l(),i("div",K,[e("div",O,[e("div",Q,[e("div",U,n(o.value.length),1),s[5]||(s[5]=e("div",{class:"stat-label"},"Experiencias",-1))]),e("div",W,[e("div",X,n(w.value),1),s[6]||(s[6]=e("div",{class:"stat-label"},"Reservas Totales",-1))]),e("div",Y,[e("div",Z,n(C.value),1),s[7]||(s[7]=e("div",{class:"stat-label"},"Activas",-1))])]),e("div",ee,[(l(!0),i(L,null,V(o.value,a=>(l(),i("div",{key:a.id,class:"experience-card"},[e("div",se,[e("img",{src:A(a),alt:a.title},null,8,te),e("div",ae,[e("div",ne,[e("button",{onClick:g=>R(a),class:"btn-action edit"},s[8]||(s[8]=[e("i",{class:"pi pi-pencil"},null,-1)]),8,ie),e("button",{onClick:g=>$(a),class:"btn-action delete"},s[9]||(s[9]=[e("i",{class:"pi pi-trash"},null,-1)]),8,le)])])]),e("div",oe,[e("h3",re,n(a.title),1),e("p",ce,[s[10]||(s[10]=e("i",{class:"pi pi-map-marker"},null,-1)),E(" "+n(a.location),1)]),e("p",de,n(S(a.description)),1),e("div",ue,[e("span",pe,n(a.difficultyLevel||a.difficulty||"Moderado"),1),e("span",ve,n(D(a)),1)]),e("div",me,[e("div",ge,[s[11]||(s[11]=e("i",{class:"pi pi-calendar"},null,-1)),e("span",null,n(N(a.id))+" reservas",1)]),e("div",xe,[s[12]||(s[12]=e("i",{class:"pi pi-users"},null,-1)),e("span",null,"Max "+n(a.maxParticipants||a.maxGroupSize||"N/A"),1)])])])]))),128))]),o.value.length===0?(l(),i("div",_e,[s[14]||(s[14]=e("i",{class:"pi pi-calendar-plus"},null,-1)),s[15]||(s[15]=e("h3",null,"No tienes experiencias creadas",-1)),s[16]||(s[16]=e("p",null,"Crea tu primera experiencia para empezar a recibir reservas",-1)),e("button",{onClick:y,class:"btn-primary"},s[13]||(s[13]=[e("i",{class:"pi pi-plus"},null,-1),E(" Crear primera experiencia ")]))])):b("",!0)])),_.value?(l(),i("div",{key:3,class:"modal-overlay",onClick:m},[e("div",{class:"modal",onClick:s[0]||(s[0]=j(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[18]||(s[18]=e("h3",null,"Confirmar eliminación",-1)),e("button",{onClick:m,class:"btn-close"},s[17]||(s[17]=[e("i",{class:"pi pi-times"},null,-1)]))]),e("div",Ee,[e("p",null,'¿Estás seguro de que quieres eliminar la experiencia "'+n((r=d.value)==null?void 0:r.title)+'"?',1),s[19]||(s[19]=e("p",{class:"warning"},"Esta acción no se puede deshacer.",-1))]),e("div",fe,[e("button",{onClick:m,class:"btn-secondary"},"Cancelar"),e("button",{onClick:F,class:"btn-danger",disabled:v.value},[v.value?(l(),i("i",he)):(l(),i("span",be,"Eliminar"))],8,ye)])])])):b("",!0)])}}},Ae=T(ke,[["__scopeId","data-v-9d093dec"]]);export{Ae as default};

import{_ as R,r as _,c as h,A as S,m as w,a as o,o as i,b as e,t as l,g as u,n as C,F as V,k as N,w as y,p as I,f as z}from"./index-BPhHBPve.js";import{u as E}from"./page-state.service-dWtiwY-7.js";const B={class:"reservations-emergency"},L={class:"header"},M=["disabled"],U={key:0,class:"loading-state"},j={key:1,class:"error-state"},F={class:"error-message"},q={key:2,class:"empty-state"},H={class:"empty-message"},J={key:3,class:"reservations-list"},O={class:"reservation-header"},Y={class:"reservation-details"},G={class:"detail-item"},K={class:"detail-item"},Q={class:"detail-item"},W={key:0,class:"reservation-actions"},X=["onClick","disabled"],Z=["onClick","disabled"],ee={key:1,class:"reservation-actions"},se=["onClick","disabled"],te={__name:"reservations-emergency.component",setup(A){const c=E("reservations"),n=_([]),d=_(!1),v=_(null),m=h(()=>S.fromStorage()),p=h(()=>{var t;return((t=m.value)==null?void 0:t.isAgency())??!1}),b=[{id:1,experienceTitle:"Senderismo en la Cordillera",date:"2024-08-15",participants:2,totalPrice:120,status:"confirmed"},{id:2,experienceTitle:"Avistamiento de Aves",date:"2024-08-20",participants:3,totalPrice:180,status:"pending"}],g=async()=>{d.value=!0,v.value=null;try{console.log("[ReservationsEmergency] Loading reservations from API...");const t=await fetch("http://localhost:3003/reservations");if(t.ok){const s=await t.json();console.log("[ReservationsEmergency] Loaded reservations:",s);const a=s.filter(r=>p.value?r.agencyId===m.value.userId:r.userId===m.value.userId);n.value=a}else console.log("[ReservationsEmergency] API not available, using mock data"),n.value=b;c.saveData(n.value)}catch(t){console.error("Error loading reservations:",t),console.log("[ReservationsEmergency] Using mock data as fallback"),n.value=b}finally{d.value=!1}},f=async(t,s)=>{console.log(`[ReservationsEmergency] Updating reservation ${t} to ${s}`);const a=n.value.find(r=>r.id===t);if(a){const r=a.status;a.status=s;try{if((await fetch(`http://localhost:3003/reservations/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})})).ok)console.log(`[ReservationsEmergency] Successfully updated reservation ${t} to ${s}`),c.saveData(n.value),alert(`Reserva ${s==="confirmed"?"confirmada":"cancelada"} exitosamente`);else throw new Error("API response not ok")}catch(k){console.error("Error updating reservation:",k),a.status=r,alert("Error al actualizar la reserva. Por favor intenta de nuevo.")}}},$=async t=>{console.log(`[ReservationsEmergency] Cancelling reservation ${t}`),confirm("¿Estás seguro de que deseas cancelar esta reserva?")&&await f(t,"cancelled")},x=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),P=t=>`S/ ${t}`,D=t=>{switch(t){case"confirmed":return"status-confirmed";case"cancelled":return"status-cancelled";case"pending":return"status-pending";default:return"status-unknown"}},T=t=>{switch(t){case"confirmed":return"Confirmada";case"cancelled":return"Cancelada";case"pending":return"Pendiente";default:return"Desconocido"}};return w(async()=>{const t=c.getData();t&&t.length>0?n.value=t:await g()}),(t,s)=>(i(),o("div",B,[e("div",L,[e("h2",null,l(p.value?"Reservas recibidas":"Mis reservas"),1),e("button",{onClick:g,class:"refresh-button",disabled:d.value},[e("i",{class:C(["pi pi-refresh",{"pi-spin":d.value}])},null,2),s[0]||(s[0]=u(" Actualizar "))],8,M)]),d.value?(i(),o("div",U,s[1]||(s[1]=[e("div",{class:"loading-spinner"},[e("i",{class:"pi pi-spinner pi-spin"}),e("span",null,"Cargando reservas...")],-1)]))):v.value?(i(),o("div",j,[e("div",F,[s[2]||(s[2]=e("i",{class:"pi pi-exclamation-triangle"},null,-1)),e("span",null,l(v.value),1)]),e("button",{onClick:g,class:"retry-button"},s[3]||(s[3]=[e("i",{class:"pi pi-refresh"},null,-1),u(" Reintentar ")]))])):n.value.length===0?(i(),o("div",q,[e("div",H,[s[4]||(s[4]=e("i",{class:"pi pi-calendar"},null,-1)),s[5]||(s[5]=e("h3",null,"No tienes reservas",-1)),e("p",null,l(p.value?"Aún no has recibido reservas":"No has realizado ninguna reserva"),1)])])):(i(),o("div",J,[(i(!0),o(V,null,N(n.value,a=>(i(),o("div",{key:a.id,class:"reservation-card"},[e("div",O,[e("h4",null,l(a.experienceTitle||"Experiencia"),1),e("span",{class:C(["status",D(a.status)])},l(T(a.status)),3)]),e("div",Y,[e("div",G,[s[6]||(s[6]=e("i",{class:"pi pi-calendar"},null,-1)),e("span",null,l(x(a.date)),1)]),e("div",K,[s[7]||(s[7]=e("i",{class:"pi pi-users"},null,-1)),e("span",null,l(a.participants)+" personas",1)]),e("div",Q,[s[8]||(s[8]=e("i",{class:"pi pi-dollar"},null,-1)),e("span",null,l(P(a.totalPrice)),1)])]),p.value?(i(),o("div",W,[e("button",{onClick:y(r=>f(a.id,"confirmed"),["stop"]),disabled:a.status==="confirmed",class:"action-button confirm"},s[9]||(s[9]=[e("i",{class:"pi pi-check"},null,-1),u(" Confirmar ")]),8,X),e("button",{onClick:y(r=>f(a.id,"cancelled"),["stop"]),disabled:a.status==="cancelled",class:"action-button cancel"},s[10]||(s[10]=[e("i",{class:"pi pi-times"},null,-1),u(" Cancelar ")]),8,Z)])):(i(),o("div",ee,[e("button",{onClick:y(r=>$(a.id),["stop"]),disabled:a.status==="cancelled",class:"action-button cancel"},s[11]||(s[11]=[e("i",{class:"pi pi-times"},null,-1),u(" Cancelar Reserva ")]),8,se)]))]))),128))]))]))}},ae=R(te,[["__scopeId","data-v-b7cf2aba"]]),ne={class:"reservations-page"},oe={__name:"reservations-view.page",setup(A){const c=E("reservations");return h(()=>{const n=S.fromStorage();return(n==null?void 0:n.isAgency())??!1}),I(()=>{console.log("[ReservationsView] Saving state before unmount..."),c.saveState({scrollPosition:window.scrollY,lastVisited:Date.now()})}),w(()=>{console.log("[ReservationsView] Component mounted, restoring state..."),c.hasState()&&setTimeout(()=>{c.restoreScroll()},100)}),(n,d)=>(i(),o("div",ne,[z(ae)]))}},le=R(oe,[["__scopeId","data-v-5b7a9212"]]);export{le as default};

import{_ as S,a as v,o as c,b as e,e as C,t as d,I as k,u as f,g as x,r as $,c as w,A as R,m as I,F as A,p as b,k as B,f as y,l as E,K as P,s as D,L as N}from"./index-BHEtbWzy.js";import{h}from"./httpClient-Bnjko1En.js";const L={class:"reservations-list-container"},T={class:"reservations-info-container"},V={class:"reservations-info-profile"},q={class:"profile-info"},F={class:"reservations-info-total"},M={key:0,class:"action-buttons"},O={__name:"reservations-list-item.component",props:{name:{type:String,required:!0},date:{type:String,required:!0},experience:{type:String,required:!0},people:{type:Number,required:!0},totalPaid:{type:Number,required:!0},status:{type:String,default:"pending"},showActions:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(l,{emit:r}){const t=l,o=computed(()=>{switch(t.status){case"confirmed":return"var(--green-500)";case"cancelled":return"var(--red-500)";default:return"var(--yellow-500)"}}),p=computed(()=>{switch(t.status){case"confirmed":return"Confirmada";case"cancelled":return"Cancelada";default:return"Pendiente"}});return(u,s)=>(c(),v("div",L,[e("div",T,[e("div",V,[s[2]||(s[2]=e("img",{src:"https://i.pravatar.cc/150?u=tourist1",alt:"Foto",class:"profile-photo"},null,-1)),e("div",q,[e("h1",null,d(l.name),1),e("span",{class:"status-badge",style:k({backgroundColor:f(o)})},d(f(p)),5)])]),e("div",F,[e("div",null,[s[3]||(s[3]=e("h2",null,"Fecha",-1)),e("h3",null,d(l.date),1)]),e("div",null,[s[4]||(s[4]=e("h2",null,"Experiencia",-1)),e("h3",null,d(l.experience),1)]),e("div",null,[s[5]||(s[5]=e("h2",null,"Personas",-1)),e("h3",null,d(l.people),1)]),e("div",null,[s[6]||(s[6]=e("h2",null,"Total",-1)),e("h3",null,"S/ "+d(l.totalPaid),1)])]),l.showActions&&l.status==="pending"?(c(),v("div",M,[e("button",{class:"action-btn confirm",onClick:s[0]||(s[0]=m=>u.$emit("confirm"))},s[7]||(s[7]=[e("i",{class:"pi pi-check"},null,-1),x(" Confirmar ")])),e("button",{class:"action-btn cancel",onClick:s[1]||(s[1]=m=>u.$emit("cancel"))},s[8]||(s[8]=[e("i",{class:"pi pi-times"},null,-1),x(" Cancelar ")]))])):C("",!0)])]))}},z=S(O,[["__scopeId","data-v-92a2af9a"]]);class K{async createReservation(r){try{return await h.post("/reservations",r)}catch(t){throw console.error("[ReservationsApiService] Error creating reservation:",t),t}}async getReservationsByTouristId(r){try{return await h.get(`/reservations?userId=${r}`)}catch(t){throw console.error("[ReservationsApiService] Error fetching tourist reservations:",t),t}}async getReservationsByAgencyId(r){try{return await h.get(`/reservations?agencyId=${r}`)}catch(t){throw console.error("[ReservationsApiService] Error fetching agency reservations:",t),t}}async updateReservationStatus(r,t){try{return await h.patch(`/reservations/${r}`,{status:t})}catch(o){throw console.error("[ReservationsApiService] Error updating reservation status:",o),o}}async getReservationDetails(r){try{return await h.get(`/reservations/${r}`)}catch(t){throw console.error("[ReservationsApiService] Error fetching reservation details:",t),t}}}class j{constructor({id:r="",experienceId:t="",userId:o="",date:p=new Date,numberOfPeople:u=1,status:s="pending",totalPrice:m=0,experience:g={name:"",image:""},tourist:i={name:"",avatar:""},agency:n={id:"",name:"",avatar:""}}){this.id=r,this.experienceId=t,this.userId=o,this.date=new Date(p),this.numberOfPeople=u,this.status=s,this.totalPrice=m,this.experience=g,this.tourist=i,this.agency=n}get formattedDate(){return this.date.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}get statusColor(){switch(this.status){case"confirmed":return"var(--green-500)";case"cancelled":return"var(--red-500)";default:return"var(--yellow-500)"}}get statusText(){switch(this.status){case"confirmed":return"Confirmada";case"cancelled":return"Cancelada";default:return"Pendiente"}}}const G={class:"reservations-list"},H={key:0,class:"loading-state"},J={key:1,class:"error-state"},Q={key:2,class:"empty-state"},U={__name:"reservations-list.component",setup(l){const r=new K,t=$([]),o=$(!0),p=$(null),u=w(()=>R.fromStorage()),s=w(()=>{var i;return((i=u.value)==null?void 0:i.isAgency())??!1}),m=w(()=>t.value.sort((i,n)=>n.date-i.date));async function g(i,n){try{await r.updateReservationStatus(i,n);const a=t.value.findIndex(_=>_.id===i);a!==-1&&(t.value[a].status=n)}catch(a){console.error("Error updating reservation status:",a),alert("Could not update reservation status")}}return I(async()=>{var i;if((i=u.value)!=null&&i.isValid())try{const n=s.value?await r.getReservationsByAgencyId(u.value.userId):await r.getReservationsByTouristId(u.value.userId);t.value=n.data.map(a=>new j(a))}catch(n){console.error("Error loading reservations:",n),p.value="Could not load reservations"}finally{o.value=!1}}),(i,n)=>(c(),v("div",G,[o.value?(c(),v("div",H,n[0]||(n[0]=[e("i",{class:"pi pi-spin pi-spinner loading-icon"},null,-1),e("p",null,"Loading reservations...",-1)]))):p.value?(c(),v("div",J,[n[1]||(n[1]=e("i",{class:"pi pi-exclamation-triangle error-icon"},null,-1)),e("p",null,d(p.value),1)])):m.value.length===0?(c(),v("div",Q,[n[2]||(n[2]=e("i",{class:"pi pi-calendar-times empty-icon"},null,-1)),e("p",null,d(s.value?"No hay reservas pendientes":"AÃºn no tienes reservas"),1)])):(c(!0),v(A,{key:3},b(m.value,a=>(c(),B(z,{key:a.id,name:s.value?a.tourist.name:a.agency.name,date:a.formattedDate,experience:a.experience.name,people:a.numberOfPeople,"total-paid":a.totalPrice,status:a.status,"show-actions":s.value,onConfirm:_=>g(a.id,"confirmed"),onCancel:_=>g(a.id,"cancelled")},null,8,["name","date","experience","people","total-paid","status","show-actions","onConfirm","onCancel"]))),128))]))}},W=S(U,[["__scopeId","data-v-09641c3a"]]),X={class:"p-fluid px-3 py-3 reservations-container"},Y={class:"reservations-container-header"},Z={class:"reservations-tittle"},ee={class:"reservations-container-search-revenues"},te={class:"reservations-container-search"},se={key:0,class:"reservations-container-revenues"},re={__name:"reservations-view.page",setup(l){const r=w(()=>{const t=R.fromStorage();return(t==null?void 0:t.isAgency())??!1});return(t,o)=>(c(),v(A,null,[e("div",X,[e("div",Y,[e("h3",Z,d(r.value?"Reservas recibidas":"Mis reservas"),1)]),e("div",ee,[e("div",te,[y(f(N),null,{default:E(()=>[y(f(P),{class:"pi pi-search"}),y(f(D),{placeholder:"Buscar reservas...",class:"search-box"})]),_:1})]),r.value?(c(),v("div",se,o[0]||(o[0]=[e("div",{class:"reservations-container-revenues-total"},[e("h4",null,"Ingresos totales: S/ 2540")],-1)]))):C("",!0)])]),y(W)],64))}},oe=S(re,[["__scopeId","data-v-14f57c1d"]]);export{oe as default};

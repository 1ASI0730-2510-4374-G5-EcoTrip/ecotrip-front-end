import{_ as T,c as $,C as A,r as b,m as D,A as C,i as M,a as d,b as l,t as E,f as u,u as r,s as p,q as U,v as k,E as S,F as y,k as I,g as x,w as j,o as c}from"./index-BPhHBPve.js";import{E as B}from"./experience.service-ClOJtLbE.js";import"./httpClient-DpjTLT7X.js";const L={class:"experience-form"},F={class:"header"},O={class:"form-group"},J={class:"form-group"},H={class:"form-row"},K={class:"form-group"},Q={class:"form-group"},W={class:"form-row"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},ee={class:"images-list"},te=["onClick"],le={class:"form-row"},ae={class:"form-group"},ie={class:"items-list"},oe=["onClick"],ne={class:"form-group"},se={class:"items-list"},ue=["onClick"],re={class:"form-group"},de={class:"form-actions"},ce=["disabled"],me={__name:"experience-form.component",setup(pe){const f=A(),g=M(),w=new B,v=$(()=>!!f.params.id),m=b(!1),V=b(null),t=b({title:"",description:"",location:"",duration:"",price:0,maxGroupSize:10,images:[""],included:[""],notIncluded:[""],important:"",categories:[],sustainability:{ecoCertifications:[],sustainablePractices:[],localCommunityImpact:""},difficulty:"Moderado",languages:["Español"]});D(async()=>{var e,a,o,s;const n=C.fromStorage();if(!(n!=null&&n.isAgency())){g.push("/experiences");return}if(v.value)try{m.value=!0;const i=await w.getExperienceById(f.params.id);t.value={title:i.title||"",description:i.description||"",location:i.location||"",duration:`${((e=i.duration)==null?void 0:e.value)||0} ${((a=i.duration)==null?void 0:a.unit)||"hours"}`,price:((o=i.price)==null?void 0:o.amount)||i.price||0,maxGroupSize:i.maxParticipants||i.maxGroupSize||10,images:i.images||[""],included:i.includedItems||i.included||[""],notIncluded:i.notIncluded||[""],important:((s=i.requirements)==null?void 0:s.join(", "))||i.important||"",categories:i.categories||[],sustainability:i.sustainability||{ecoCertifications:i.ecoCertifications||[],sustainablePractices:i.sustainablePractices||[],localCommunityImpact:i.localCommunityImpact||""},difficulty:i.difficultyLevel||i.difficulty||"medium",languages:i.languages||["Español"]},t.value.images.length===0&&(t.value.images=[""]),t.value.included.length===0&&(t.value.included=[""]),t.value.notIncluded.length===0&&(t.value.notIncluded=[""])}catch(i){console.error("Error loading experience:",i),V.value=i.message}finally{m.value=!1}});async function _(){try{m.value=!0;const n=C.fromStorage(),e={title:t.value.title,description:t.value.description,location:t.value.location,duration:{value:parseInt(t.value.duration.split(" ")[0])||1,unit:t.value.duration.split(" ")[1]||"hours"},price:{amount:t.value.price,currency:"EUR"},maxParticipants:t.value.maxGroupSize,images:t.value.images.filter(a=>a.trim()!==""),includedItems:t.value.included.filter(a=>a.trim()!==""),requirements:t.value.important.split(",").map(a=>a.trim()).filter(a=>a!==""),ecoCertifications:t.value.sustainability.ecoCertifications||[],sustainablePractices:t.value.sustainability.sustainablePractices||[],localCommunityImpact:t.value.sustainability.localCommunityImpact||"",difficultyLevel:t.value.difficulty,agencyId:n.userId,type:"Naturaleza",rating:4.5,reviewCount:0,isSustainable:!0,availableDates:[]};if(v.value){if(!(await fetch(`http://localhost:3003/experiences/${f.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Error al actualizar la experiencia")}else if(!(await fetch("http://localhost:3003/experiences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Error al crear la experiencia");alert(v.value?"Experiencia actualizada exitosamente":"Experiencia creada exitosamente"),g.push("/manage-experiences")}catch(n){console.error("Error saving experience:",n),V.value=n.message,alert("Error al guardar la experiencia")}finally{m.value=!1}}function h(){g.push("/manage-experiences")}function P(){t.value.images.push("")}function q(n){t.value.images.splice(n,1)}function N(){t.value.included.push("")}function z(n){t.value.included.splice(n,1)}function G(){t.value.notIncluded.push("")}function R(n){t.value.notIncluded.splice(n,1)}return(n,e)=>(c(),d("div",L,[l("div",F,[l("h1",null,E(v.value?"Editar Experiencia":"Nueva Experiencia"),1)]),l("form",{onSubmit:j(_,["prevent"]),class:"form-content"},[l("div",O,[e[7]||(e[7]=l("label",null,"Título",-1)),u(r(p),{modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.title=a),required:""},null,8,["modelValue"])]),l("div",J,[e[8]||(e[8]=l("label",null,"Descripción",-1)),U(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.description=a),class:"form-textarea",required:""},null,512),[[k,t.value.description]])]),l("div",H,[l("div",K,[e[9]||(e[9]=l("label",null,"Ubicación",-1)),u(r(p),{modelValue:t.value.location,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.location=a),required:""},null,8,["modelValue"])]),l("div",Q,[e[10]||(e[10]=l("label",null,"Duración",-1)),u(r(p),{modelValue:t.value.duration,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.duration=a),placeholder:"Ej: 2 días",required:""},null,8,["modelValue"])])]),l("div",W,[l("div",X,[e[11]||(e[11]=l("label",null,"Precio (EUR)",-1)),u(r(S),{modelValue:t.value.price,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.price=a),mode:"currency",currency:"EUR",required:""},null,8,["modelValue"])]),l("div",Y,[e[12]||(e[12]=l("label",null,"Máximo de Participantes",-1)),u(r(S),{modelValue:t.value.maxGroupSize,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.maxGroupSize=a),min:1,required:""},null,8,["modelValue"])])]),l("div",Z,[e[15]||(e[15]=l("label",null,"Imágenes (URLs)",-1)),l("div",ee,[(c(!0),d(y,null,I(t.value.images,(a,o)=>(c(),d("div",{key:o,class:"image-item"},[u(r(p),{modelValue:t.value.images[o],"onUpdate:modelValue":s=>t.value.images[o]=s,placeholder:"https://"},null,8,["modelValue","onUpdate:modelValue"]),l("button",{type:"button",class:"remove-button",onClick:s=>q(o)},e[13]||(e[13]=[l("i",{class:"pi pi-times"},null,-1)]),8,te)]))),128))]),l("button",{type:"button",class:"add-button",onClick:P},e[14]||(e[14]=[l("i",{class:"pi pi-plus"},null,-1),x(" Agregar Imagen ")]))]),l("div",le,[l("div",ae,[e[18]||(e[18]=l("label",null,"Incluye",-1)),l("div",ie,[(c(!0),d(y,null,I(t.value.included,(a,o)=>(c(),d("div",{key:o,class:"list-item"},[u(r(p),{modelValue:t.value.included[o],"onUpdate:modelValue":s=>t.value.included[o]=s},null,8,["modelValue","onUpdate:modelValue"]),l("button",{type:"button",class:"remove-button",onClick:s=>z(o)},e[16]||(e[16]=[l("i",{class:"pi pi-times"},null,-1)]),8,oe)]))),128))]),l("button",{type:"button",class:"add-button",onClick:N},e[17]||(e[17]=[l("i",{class:"pi pi-plus"},null,-1),x(" Agregar Item ")]))]),l("div",ne,[e[21]||(e[21]=l("label",null,"No Incluye",-1)),l("div",se,[(c(!0),d(y,null,I(t.value.notIncluded,(a,o)=>(c(),d("div",{key:o,class:"list-item"},[u(r(p),{modelValue:t.value.notIncluded[o],"onUpdate:modelValue":s=>t.value.notIncluded[o]=s},null,8,["modelValue","onUpdate:modelValue"]),l("button",{type:"button",class:"remove-button",onClick:s=>R(o)},e[19]||(e[19]=[l("i",{class:"pi pi-times"},null,-1)]),8,ue)]))),128))]),l("button",{type:"button",class:"add-button",onClick:G},e[20]||(e[20]=[l("i",{class:"pi pi-plus"},null,-1),x(" Agregar Item ")]))])]),l("div",re,[e[22]||(e[22]=l("label",null,"Requisitos/Información Importante",-1)),U(l("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.important=a),class:"form-textarea",placeholder:"Separar con comas"},null,512),[[k,t.value.important]])]),l("div",de,[l("button",{type:"button",class:"cancel-button",onClick:h},"Cancelar"),l("button",{type:"submit",class:"save-button",disabled:m.value},E(m.value?"Guardando...":"Guardar"),9,ce)])],32)]))}},be=T(me,[["__scopeId","data-v-98e33121"]]);export{be as default};

import{h as l}from"./httpClient-DusnwknQ.js";class F{constructor(){this._domainEvents=[]}addDomainEvent(e){this._domainEvents.push(e)}clearDomainEvents(){this._domainEvents=[]}getDomainEvents(){return[...this._domainEvents]}}class o{equals(e){return e==null||e.constructor!==this.constructor?!1:JSON.stringify(this)===JSON.stringify(e)}}class S extends o{constructor(e){super(),this.value=e}}class A extends o{constructor(e){super(),this.value=e}validate(){var e;if(!((e=this.value)!=null&&e.trim()))throw new Error("El título es requerido");if(this.value.length>100)throw new Error("El título no puede exceder los 100 caracteres")}}class C extends o{constructor(e){super(),this.value=e}validate(){var e;if(!((e=this.value)!=null&&e.trim()))throw new Error("La descripción es requerida");if(this.value.length>2e3)throw new Error("La descripción no puede exceder los 2000 caracteres")}}class P extends o{constructor(e){super(),this.value=e}validate(){if(typeof this.value!="number"||this.value<0)throw new Error("El precio debe ser un número positivo")}format(){return`S/ ${this.value.toFixed(2)}`}}class $ extends o{constructor(e){super(),this.value=e}validate(){var e;if(!((e=this.value)!=null&&e.trim()))throw new Error("La ubicación es requerida")}format(){return this.value}}class q extends o{constructor(e){super(),this.value=e}validate(){var e;if(!((e=this.value)!=null&&e.trim()))throw new Error("La duración es requerida")}format(){return this.value}}class h extends F{constructor({id:e="",title:r="",description:t="",location:i="",duration:a="0 días",price:c=0,images:E=[],included:w=[],notIncluded:x=[],important:y="",agencyId:g="",categories:m=[],sustainability:f={ecoCertifications:[],sustainablePractices:[],localCommunityImpact:""},difficulty:v="medium",maxGroupSize:R=10,languages:I=["Español"],reviews:b=[]}){super(),this.id=new S(e),this.title=new A(r),this.description=new C(t),this.price=new P(c),this.location=new $(i),this.duration=new q(a),this.images=E,this.included=w,this.notIncluded=x,this.important=y,this.agencyId=g,this.categories=m,this.sustainability=f,this.difficulty=v,this.maxGroupSize=R,this.languages=I,this._reviews=b}validate(){var e,r,t,i,a;if(!((r=(e=this.title)==null?void 0:e.value)!=null&&r.trim()))throw new Error("El título es requerido");if(!((i=(t=this.description)==null?void 0:t.value)!=null&&i.trim()))throw new Error("La descripción es requerida");if(!this.agencyId)throw new Error("La experiencia debe estar asociada a una agencia");if(!((a=this.images)!=null&&a.length))throw new Error("Debe incluir al menos una imagen")}addReview(e,r,t){const i={userId:e,rating:r,comment:t,date:new Date};return this._reviews.push(i),i}isEcoFriendly(){return this.sustainability.ecoCertifications.length>0||this.sustainability.sustainablePractices.length>0}getFormattedPrice(){return this.price.format()}getDurationText(){return this.duration.format()}getLocationText(){return this.location.format()}addCategory(e){this.categories.includes(e)||this.categories.push(e)}removeCategory(e){const r=this.categories.indexOf(e);r>-1&&this.categories.splice(r,1)}addSustainablePractice(e){this.sustainability.sustainablePractices.includes(e)||this.sustainability.sustainablePractices.push(e)}addEcoCertification(e){this.sustainability.ecoCertifications.includes(e)||this.sustainability.ecoCertifications.push(e)}toJSON(){return{id:this.id.value,title:this.title.value,description:this.description.value,location:this.location.value,duration:this.duration.value,price:this.price.value,images:[...this.images],included:[...this.included],notIncluded:[...this.notIncluded],important:this.important,agencyId:this.agencyId,categories:[...this.categories],sustainability:{...this.sustainability},difficulty:this.difficulty,maxGroupSize:this.maxGroupSize,languages:[...this.languages],reviews:this._reviews.map(e=>({...e}))}}}class n{static toEntityFromResource(e){var r,t,i;return e?new h({id:e.id||Date.now().toString(),title:e.title||"",description:e.description||"",location:e.location||"",duration:(r=e.duration)!=null&&r.value?`${e.duration.value} ${e.duration.unit}`:"0 días",price:((t=e.price)==null?void 0:t.amount)||0,images:e.images||[],included:e.includedItems||[],notIncluded:e.notIncluded||[],important:e.localCommunityImpact||"",agencyId:e.agencyId||"",categories:Array.isArray(e.type)?e.type:[e.type||""],sustainability:{ecoCertifications:e.ecoCertifications||[],sustainablePractices:e.sustainablePractices||[],localCommunityImpact:e.localCommunityImpact||""},difficulty:((i=e.difficultyLevel)==null?void 0:i.toLowerCase())||"medium",maxGroupSize:e.maxParticipants||10,languages:e.languages||["Español"],reviews:e.reviews||[]}):null}static toEntitiesFromResponse(e){return e!=null&&e.data?Array.isArray(e.data)?e.data.map(r=>this.toEntityFromResource(r)):[this.toEntityFromResource(e.data)]:(console.error("Invalid response:",e),[])}static toRequestPayload(e){const[r,t]=e.duration.value.split(" ");return{id:e.id.value,title:e.title.value,description:e.description.value,location:e.location.value,duration:{value:parseInt(r),unit:t},price:{amount:e.price.value,currency:"EUR"},images:[...e.images],includedItems:[...e.included],type:e.categories[0],isSustainable:!0,ecoCertifications:e.sustainability.ecoCertifications,sustainablePractices:e.sustainability.sustainablePractices,localCommunityImpact:e.sustainability.localCommunityImpact,agencyId:e.agencyId,maxParticipants:e.maxGroupSize,difficultyLevel:e.difficulty.charAt(0).toUpperCase()+e.difficulty.slice(1),languages:[...e.languages],reviews:e._reviews.map(i=>({...i}))}}}class D{constructor(){this.baseURL="http://localhost:3000"}async getExperiences(){try{return await l.get("/experiences")}catch(e){throw console.error("[ExperiencesApiService] Error fetching experiences:",e),this.handleError(e)}}async getById(e){try{if(!e)throw new Error("Experience ID is required");return await l.get(`/experiences/${e}`)}catch(r){throw console.error("[ExperiencesApiService] Error fetching experience:",r),this.handleError(r)}}async createExperience(e){try{const r=n.toRequestPayload(e);return await l.post("/experiences",r)}catch(r){throw console.error("[ExperiencesApiService] Error creating experience:",r),this.handleError(r)}}async updateExperience(e,r){try{if(!e)throw new Error("Experience ID is required");const t=n.toRequestPayload(r);return await l.put(`/experiences/${e}`,t)}catch(t){throw console.error("[ExperiencesApiService] Error updating experience:",t),this.handleError(t)}}async deleteExperience(e){try{if(!e)throw new Error("Experience ID is required");return await l.delete(`/experiences/${e}`),{success:!0}}catch(r){throw console.error("[ExperiencesApiService] Error deleting experience:",r),this.handleError(r)}}handleError(e){if(!e.response)return new Error("Network error");switch(e.response.status){case 400:return new Error("Invalid request data");case 401:return new Error("Unauthorized");case 403:return new Error("Forbidden");case 404:return new Error("Experience not found");case 500:return new Error("Server error");default:return e}}}class L{constructor(){this.apiService=new D}async findAll(){try{const e=await this.apiService.getExperiences();return n.toEntitiesFromResponse(e)}catch(e){throw console.error("[ExperienceRepository] Error getting experiences:",e),e}}async findById(e){try{const r=await this.apiService.getById(e);return n.toEntityFromResource(r.data)}catch(r){throw console.error(`[ExperienceRepository] Error getting experience with id ${e}:`,r),r}}async save(e){try{const r=await this.apiService.createExperience(e);return n.toEntityFromResource(r.data)}catch(r){throw console.error("[ExperienceRepository] Error saving experience:",r),r}}async update(e,r){try{const t=await this.apiService.updateExperience(e,r);return n.toEntityFromResource(t.data)}catch(t){throw console.error(`[ExperienceRepository] Error updating experience with id ${e}:`,t),t}}async delete(e){try{return await this.apiService.deleteExperience(e),!0}catch(r){throw console.error(`[ExperienceRepository] Error deleting experience with id ${e}:`,r),r}}async findByAgencyId(e){try{return(await this.findAll()).filter(t=>t.agencyId===e)}catch(r){throw console.error(`[ExperienceRepository] Error getting experiences for agency ${e}:`,r),r}}}class u extends Error{constructor(e){super(`Experience with id ${e} not found`),this.name="ExperienceNotFoundError"}}class d extends Error{constructor(e){super(e),this.name="InvalidExperienceDataError"}}class p extends Error{constructor(e){super(e),this.name="ExperienceValidationError"}}class _{constructor(e=new L){this.experienceRepository=e}async getAllExperiences(){try{return(await this.experienceRepository.findAll()).map(r=>n.toEntityFromResource(r))}catch(e){throw console.error("Error getting experiences:",e),new Error("Failed to fetch experiences")}}async getExperienceById(e){try{const r=await this.experienceRepository.findById(e);if(!r)throw new u(e);return n.toEntityFromResource(r)}catch(r){throw console.error(`Error getting experience with id ${e}:`,r),r instanceof u?r:new d(`Failed to fetch experience with id ${e}`)}}async createExperience(e){try{const r=new h(e);try{r.validate()}catch(i){throw new p(i.message)}const t=await this.experienceRepository.save(n.toRequestPayload(r));return n.toEntityFromResource(t)}catch(r){throw console.error("Error creating experience:",r),r instanceof p?r:new d("Failed to create experience: "+r.message)}}async updateExperience(e,r){try{const t=await this.experienceRepository.findById(e);if(!t)throw new u(e);const i=new h({...n.toEntityFromResource(t).toJSON(),...r});try{i.validate()}catch(c){throw new p(c.message)}const a=await this.experienceRepository.update(e,n.toRequestPayload(i));return n.toEntityFromResource(a)}catch(t){throw console.error(`Error updating experience with id ${e}:`,t),t instanceof u||t instanceof p?t:new d(`Failed to update experience: ${t.message}`)}}async deleteExperience(e){try{if(!await this.experienceRepository.findById(e))throw new Error("Experience not found");return await this.experienceRepository.delete(e),!0}catch(r){throw console.error(`Error deleting experience with id ${e}:`,r),r.message==="Experience not found"?r:new Error("Failed to delete experience")}}async getExperiencesByAgency(e){try{return(await this.experienceRepository.findByAgencyId(e)).map(t=>n.toEntityFromResource(t))}catch(r){throw console.error(`Error getting experiences for agency ${e}:`,r),new Error("Failed to fetch agency experiences")}}async addReview(e,r,t,i){try{const a=await this.getExperienceById(e);if(!a)throw new Error("Experience not found");a.addReview(r,t,i);const c=await this.experienceRepository.save(n.toRequestPayload(a));return n.toEntityFromResource(c)}catch(a){throw console.error(`Error adding review to experience ${e}:`,a),a.message==="Experience not found"?a:new Error("Failed to add review")}}}export{_ as E};

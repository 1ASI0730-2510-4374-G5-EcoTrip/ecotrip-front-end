import{_ as J,r as v,c as R,A as k,m as Q,C as G,a,b as t,g as f,t as l,e as u,F as d,k as p,q as H,x as K,i as W,o}from"./index-BPhHBPve.js";import{E as X}from"./experience.service-ClOJtLbE.js";import"./httpClient-DpjTLT7X.js";const Y={class:"experience-details"},Z={key:0,class:"loading-state"},ee={key:1,class:"error-state"},se={key:2,class:"content"},te={class:"hero-section"},ne={class:"image-gallery"},ie=["src","alt"],ae={key:0,class:"image-thumbnails"},oe=["src","alt","onClick"],le={class:"hero-info"},re={class:"badges"},ce={key:0,class:"eco-badge"},ue={class:"difficulty-badge"},de={class:"title"},pe={class:"meta-info"},ve={class:"meta-item"},me={class:"meta-item"},ge={class:"meta-item"},_e={key:0,class:"rating-section"},fe={class:"stars"},ye={class:"rating-text"},be={class:"main-content"},he={class:"content-section"},ke={class:"left-column"},xe={class:"description-section"},Ee={class:"description"},De={class:"included-section"},Ie={class:"included-list"},Se={key:0,class:"requirements-section"},Ce={class:"requirements-list"},we={key:1,class:"sustainability-section"},Pe={class:"sustainability-content"},$e={key:0,class:"certifications"},Re={class:"cert-badges"},Te={key:1,class:"practices"},Le={key:2,class:"community-impact"},Me={class:"booking-card"},qe={class:"price-section"},Ae={class:"price"},Be={class:"booking-form"},Fe={class:"form-group"},Ne=["value"],Ue={class:"form-group"},Ve={class:"counter"},Oe=["disabled"],je=["disabled"],ze={class:"total-section"},Je={class:"total-breakdown"},Qe={class:"breakdown-item"},Ge={class:"total-final"},He=["disabled"],Ke={key:0,class:"pi pi-spin pi-spinner"},We={key:1},Xe={__name:"experience-details.page",setup(Ye){const T=G(),y=W(),L=new X,i=v(null),b=v(!0),h=v(null),m=v(""),r=v(1),g=v(!1),x=v(""),M=()=>{y.push("/experiences")},E=R(()=>{const e=k.fromStorage();return e==null?void 0:e.isValid()});R(()=>{var s;const e=k.fromStorage();return(e==null?void 0:e.isAgency())&&((s=i.value)==null?void 0:s.agencyId)===e.userId}),Q(async()=>{try{b.value=!0,i.value=await L.getExperienceById(T.params.id),x.value=w()}catch(e){console.error("Error loading experience:",e),h.value=e.message}finally{b.value=!1}});function q(){var e,s,n;return((s=(e=i.value)==null?void 0:e.id)==null?void 0:s.value)||((n=i.value)==null?void 0:n.id)}function _(){var e,s,n;return((s=(e=i.value)==null?void 0:e.title)==null?void 0:s.value)||((n=i.value)==null?void 0:n.title)||"Experiencia"}function A(){var e;return((e=i.value)==null?void 0:e.description)||"Descripción no disponible"}function D(){var e,s,n;return((s=(e=i.value)==null?void 0:e.location)==null?void 0:s.value)||((n=i.value)==null?void 0:n.location)||"Ubicación no disponible"}function B(){var e,s,n;return((s=(e=i.value)==null?void 0:e.difficultyLevel)==null?void 0:s.value)||((n=i.value)==null?void 0:n.difficultyLevel)||"Moderado"}function I(){var s;const e=(s=i.value)==null?void 0:s.duration;if(e!=null&&e.value&&(e!=null&&e.unit)){const n={hours:"horas",days:"días",minutes:"minutos"};return`${e.value} ${n[e.unit]||e.unit}`}return"Duración no disponible"}function S(){var s;const e=(s=i.value)==null?void 0:s.price;return e!=null&&e.amount&&(e!=null&&e.currency)?`${e.currency==="EUR"?"€":"$"}${e.amount}`:"Precio no disponible"}function C(){var s;const e=(s=i.value)==null?void 0:s.price;if(e!=null&&e.amount&&(e!=null&&e.currency)){const n=e.currency==="EUR"?"€":"$",c=e.amount*r.value;return`${n}${c}`}return"Total no disponible"}function w(){var s;const e=(s=i.value)==null?void 0:s.images;return Array.isArray(e)&&e.length>0?e[0]:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800"}function F(e){x.value=e}function P(e){e.target.src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800"}function N(){var e;return((e=i.value)==null?void 0:e.availableDates)||[]}function U(e){return new Date(e).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function $(){var e;return Math.floor(((e=i.value)==null?void 0:e.rating)||0)}function V(){return 5-$()}function O(){var e;r.value<((e=i.value)==null?void 0:e.maxParticipants)&&r.value++}function j(){r.value>1&&r.value--}async function z(){if(console.log("[ExperienceDetails] Book experience clicked"),!E.value){console.log("[ExperienceDetails] User not logged in, redirecting to login"),y.push("/login");return}if(!m.value){alert("Por favor selecciona una fecha");return}try{g.value=!0;const e=k.fromStorage(),s={experienceId:q(),userId:e.userId,agencyId:i.value.agencyId,date:m.value,participants:r.value,totalPrice:i.value.price.amount*r.value,status:"pending",bookingDate:new Date().toISOString(),experienceTitle:_(),experienceLocation:D(),experienceDuration:I()};console.log("[ExperienceDetails] Creating reservation:",s);const n=await fetch("http://localhost:3003/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(n.ok){const c=await n.json();console.log("[ExperienceDetails] Reservation created successfully:",c),alert("¡Reserva realizada con éxito!"),m.value="",r.value=1,y.push("/reservations")}else throw new Error("Error al crear la reserva")}catch(e){console.error("[ExperienceDetails] Error booking experience:",e),alert("Error al realizar la reserva. Inténtalo de nuevo.")}finally{g.value=!1}}return(e,s)=>(o(),a("div",Y,[b.value?(o(),a("div",Z,s[1]||(s[1]=[t("i",{class:"pi pi-spin pi-spinner"},null,-1),f(" Cargando experiencia... ")]))):h.value?(o(),a("div",ee,[s[2]||(s[2]=t("i",{class:"pi pi-exclamation-triangle"},null,-1)),f(" "+l(h.value),1)])):(o(),a("div",se,[t("div",{class:"navigation-section"},[t("button",{onClick:M,class:"back-button"},s[3]||(s[3]=[t("i",{class:"pi pi-arrow-left"},null,-1),f(" Regresar a experiencias ")]))]),t("div",te,[t("div",ne,[t("img",{src:w(),alt:_(),class:"main-image",onError:P},null,40,ie),i.value.images&&i.value.images.length>1?(o(),a("div",ae,[(o(!0),a(d,null,p(i.value.images.slice(1,4),(n,c)=>(o(),a("img",{key:c,src:n,alt:`${_()} - imagen ${c+2}`,class:"thumbnail",onClick:Ze=>F(n),onError:P},null,40,oe))),128))])):u("",!0)]),t("div",le,[t("div",re,[i.value.isSustainable?(o(),a("span",ce,s[4]||(s[4]=[t("i",{class:"pi pi-leaf"},null,-1),f(" Eco-friendly ")]))):u("",!0),t("span",ue,l(B()),1)]),t("h1",de,l(_()),1),t("div",pe,[t("div",ve,[s[5]||(s[5]=t("i",{class:"pi pi-map-marker"},null,-1)),t("span",null,l(D()),1)]),t("div",me,[s[6]||(s[6]=t("i",{class:"pi pi-clock"},null,-1)),t("span",null,l(I()),1)]),t("div",ge,[s[7]||(s[7]=t("i",{class:"pi pi-users"},null,-1)),t("span",null,"Máximo "+l(i.value.maxParticipants)+" personas",1)])]),i.value.rating?(o(),a("div",_e,[t("div",fe,[(o(!0),a(d,null,p($(),n=>(o(),a("i",{class:"pi pi-star-fill",key:"full-"+n}))),128)),(o(!0),a(d,null,p(V(),n=>(o(),a("i",{class:"pi pi-star",key:"empty-"+n}))),128))]),t("span",ye,l(i.value.rating)+" ("+l(i.value.reviewCount)+" reseñas)",1)])):u("",!0)])]),t("div",be,[t("div",he,[t("div",ke,[t("section",xe,[s[8]||(s[8]=t("h2",null,"Sobre esta experiencia",-1)),t("p",Ee,l(A()),1)]),t("section",De,[s[10]||(s[10]=t("h3",null,"¿Qué incluye?",-1)),t("ul",Ie,[(o(!0),a(d,null,p(i.value.includedItems,(n,c)=>(o(),a("li",{key:c},[s[9]||(s[9]=t("i",{class:"pi pi-check"},null,-1)),t("span",null,l(n),1)]))),128))])]),i.value.requirements?(o(),a("section",Se,[s[12]||(s[12]=t("h3",null,"Requisitos",-1)),t("ul",Ce,[(o(!0),a(d,null,p(i.value.requirements,(n,c)=>(o(),a("li",{key:c},[s[11]||(s[11]=t("i",{class:"pi pi-info-circle"},null,-1)),t("span",null,l(n),1)]))),128))])])):u("",!0),i.value.isSustainable?(o(),a("section",we,[s[16]||(s[16]=t("h3",null,"Compromiso con la sostenibilidad",-1)),t("div",Pe,[i.value.ecoCertifications?(o(),a("div",$e,[s[13]||(s[13]=t("h4",null,"Certificaciones:",-1)),t("div",Re,[(o(!0),a(d,null,p(i.value.ecoCertifications,n=>(o(),a("span",{key:n,class:"cert-badge"},l(n),1))),128))])])):u("",!0),i.value.sustainablePractices?(o(),a("div",Te,[s[14]||(s[14]=t("h4",null,"Prácticas sostenibles:",-1)),t("ul",null,[(o(!0),a(d,null,p(i.value.sustainablePractices,n=>(o(),a("li",{key:n},l(n),1))),128))])])):u("",!0),i.value.localCommunityImpact?(o(),a("div",Le,[s[15]||(s[15]=t("h4",null,"Impacto en la comunidad local:",-1)),t("p",null,l(i.value.localCommunityImpact),1)])):u("",!0)])])):u("",!0)]),t("div",Me,[t("div",qe,[t("span",Ae,l(S()),1),s[17]||(s[17]=t("span",{class:"price-unit"},"por persona",-1))]),t("div",Be,[t("div",Fe,[s[19]||(s[19]=t("label",null,"Fecha",-1)),H(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>m.value=n),class:"date-select"},[s[18]||(s[18]=t("option",{value:""},"Selecciona una fecha",-1)),(o(!0),a(d,null,p(N(),n=>(o(),a("option",{key:n,value:n},l(U(n)),9,Ne))),128))],512),[[K,m.value]])]),t("div",Ue,[s[20]||(s[20]=t("label",null,"Número de personas",-1)),t("div",Ve,[t("button",{onClick:j,disabled:r.value<=1},"-",8,Oe),t("span",null,l(r.value),1),t("button",{onClick:O,disabled:r.value>=i.value.maxParticipants},"+",8,je)])]),t("div",ze,[t("div",Je,[t("div",Qe,[t("span",null,l(S())+" × "+l(r.value)+" personas",1),t("span",null,l(C()),1)])]),t("div",Ge,[t("strong",null,"Total: "+l(C()),1)])]),t("button",{class:"book-button",onClick:z,disabled:!m.value||g.value},[g.value?(o(),a("i",Ke)):(o(),a("span",We,l(E.value?"Reservar ahora":"Inicia sesión para reservar"),1))],8,He)])])])])]))]))}},ns=J(Xe,[["__scopeId","data-v-be79c0b6"]]);export{ns as default};
